---
title: 'Webhook'
description: '接收实时会话事件和完整会话记录的 Webhook 端点'
openapi: 'WEBHOOK /api/webhook/message'
---

NavTalk 通过 Webhook 将实时会话事件和完整会话记录推送到您的服务器。本文档说明如何配置和接收这些 Webhook 事件。

## Webhook 端点

NavTalk 提供两个 Webhook 端点：

### 1. 实时事件 Webhook

**端点**: `POST /api/webhook/message`

接收实时会话事件，包括会话创建、对话输出和会话关闭。

<ParamField body="body" path="event" type="string" required>
  事件类型：`session.created`、`conversation.output`、`session.closed`
</ParamField>

<ParamField body="body" path="sessionId" type="string" required>
  会话唯一标识符
</ParamField>

<ParamField body="body" path="role" type="string" required>
  消息角色：`ai`、`user`、`system`
</ParamField>

<ParamField body="body" path="timestamp" type="string" required>
  事件时间戳（ISO 8601 格式）
</ParamField>

<ParamField body="body" path="message" type="string">
  消息内容（仅在 `conversation.output` 事件中存在）
</ParamField>

**请求示例：**

```json
{
  "event": "conversation.output",
  "sessionId": "session_123456",
  "role": "ai",
  "timestamp": "2024-01-15T10:30:00Z",
  "message": "您好，有什么可以帮助您的吗？"
}
```

**响应：**

返回 HTTP 200 状态码表示事件已成功接收。

### 2. 会话记录 Webhook

**端点**: `POST /api/webhook/session`

在会话结束时接收完整的会话记录，包括所有消息和会话元数据。

<ParamField body="body" path="sessionId" type="string" required>
  会话唯一标识符
</ParamField>

<ParamField body="body" path="startTime" type="string" required>
  会话开始时间（UTC，ISO 8601 格式）
</ParamField>

<ParamField body="body" path="endTime" type="string" required>
  会话结束时间（UTC，ISO 8601 格式）
</ParamField>

<ParamField body="body" path="messages" type="array" required>
  会话中的所有消息列表，每个消息都是 MessageData 对象
</ParamField>

**请求示例：**

```json
{
  "sessionId": "session_123456",
  "startTime": "2024-01-15T10:00:00Z",
  "endTime": "2024-01-15T10:30:00Z",
  "messages": [
    {
      "event": "conversation.output",
      "sessionId": "session_123456",
      "role": "user",
      "timestamp": "2024-01-15T10:00:05Z",
      "message": "你好"
    },
    {
      "event": "conversation.output",
      "sessionId": "session_123456",
      "role": "ai",
      "timestamp": "2024-01-15T10:00:10Z",
      "message": "您好，有什么可以帮助您的吗？"
    }
  ]
}
```

**响应：**

返回 HTTP 200 状态码表示会话记录已成功接收。

## 事件类型

### session.created

会话创建时触发。

```json
{
  "event": "session.created",
  "sessionId": "session_123456",
  "role": "system",
  "timestamp": "2024-01-15T10:00:00Z"
}
```

### conversation.output

当 AI 或用户发送消息时触发。

```json
{
  "event": "conversation.output",
  "sessionId": "session_123456",
  "role": "ai",
  "timestamp": "2024-01-15T10:00:10Z",
  "message": "您好，有什么可以帮助您的吗？"
}
```

### session.closed

会话关闭时触发。

```json
{
  "event": "session.closed",
  "sessionId": "session_123456",
  "role": "system",
  "timestamp": "2024-01-15T10:30:00Z"
}
```

## 配置 Webhook

在 NavTalk 控制台中配置 Webhook URL：

1. 登录 [NavTalk 控制台](https://console.navtalk.ai/)
2. 进入项目设置
3. 配置以下 Webhook URL：
   - **实时事件 Webhook**: `https://your-domain.com/api/webhook/message`
   - **会话记录 Webhook**: `https://your-domain.com/api/webhook/session`

## 最佳实践

- **快速响应**：在 5 秒内返回响应，避免超时
- **幂等性**：实现幂等性检查，处理重复事件
- **错误处理**：返回适当的 HTTP 状态码
- **安全性**：使用 HTTPS 并考虑实现身份验证
- **异步处理**：对于耗时操作，使用异步处理

更多详细信息，请参考 [Webhook 集成指南](/api/resources/webhook)。
